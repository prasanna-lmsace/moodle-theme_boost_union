{"version":3,"file":"smartmenu.min.js","sources":["../src/smartmenu.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Union - JS for smart menu to realize the third level submenu support.\n *\n * @module     theme_boost_union/smartmenu\n * @copyright  2023 bdecent GmbH <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\"jquery\", \"core/moremenu\", \"theme_boost_union/submenu\"], function($, MoreMenu, SubMenu) {\n\n    /**\n     * Make the no wrapped card menus scroll using swipe or drag.\n     */\n    const cardScroll = () => {\n        var cards = document.querySelectorAll('.card-dropdown.card-overflow-no-wrap');\n        if (cards !== null) {\n            var scrollStart; // Verify the mouse is clicked and still in click not released.\n            var scrollMoved; // Prevent the click on scrolling.\n            let startPos, scrollPos;\n\n            cards.forEach((card) => {\n                var scrollElement = card.querySelector('.dropdown-menu');\n\n                scrollElement.addEventListener('mousedown', (e) => {\n                    scrollStart = true;\n                    var target = e.currentTarget.querySelector('.card-block-wrapper');\n                    startPos = e.pageX;\n                    scrollPos = target.scrollLeft;\n                });\n\n                scrollElement.addEventListener('mousemove', (e) => {\n                    e.preventDefault();\n                    if (!scrollStart) {\n                        return;\n                    }\n                    scrollMoved = true;\n                    var target = e.currentTarget.querySelector('.card-block-wrapper');\n                    const scroll = e.pageX - startPos;\n                    target.scrollLeft = scrollPos - scroll;\n                });\n\n                scrollElement.addEventListener('click', (e) => {\n                    if (scrollMoved) {\n                        e.preventDefault();\n                        scrollMoved = false;\n                    }\n                    e.stopPropagation();\n                });\n                scrollElement.addEventListener('mouseleave', () => {\n                    scrollStart = false;\n                    scrollMoved = false;\n                });\n                scrollElement.addEventListener('mouseup', () => {\n                    scrollStart = false;\n                });\n            });\n        }\n    };\n\n    /**\n     * Move the menubar and primary navigation menu items from more menu.\n     */\n    const autoCollapse = () => {\n        var primaryNav = document.querySelector('.primary-navigation ul.more-nav');\n        moveOutMoreMenu(primaryNav);\n\n        var menuBar = document.querySelector('nav.menubar ul.more-nav');\n        moveOutMoreMenu(menuBar);\n    };\n\n    /**\n     * Move the items from more menu, items which is set to force outside more menu.\n     * Remove those items from more menu and insert the menu before the last normal item.\n     * Find the length and children's length to insert the out menus in that positions.\n     * Rerun the more menu it will more the other normal menus into more menu to fix the alignmenu issue.\n     *\n     * @param {HTMLElement} navMenu The navbar container.\n     */\n    const moveOutMoreMenu = (navMenu) => {\n\n        if (navMenu === null) {\n            return;\n        }\n\n        var outMenus = navMenu.querySelectorAll('.dropdownmoremenu .force-menu-out');\n        var menuslist = [];\n\n        if (outMenus === null) {\n            return;\n        }\n\n        outMenus.forEach((menu) => {\n            menu.querySelector('a').classList.remove('dropdown-item');\n            menu.querySelector('a').classList.add('nav-link');\n\n            menuslist.push(menu);\n            menu.parentNode.removeChild(menu);\n        });\n        // Find the length and children's length to insert the out menus in that positions.\n        var length = menuslist.length;\n        var navLength = navMenu.children.length - 1; // Remove more menu.\n        var newPosition = navLength - length || 0;\n        // Insert the stored menus before the more menu.\n        menuslist.forEach((menu) => navMenu.insertBefore(menu, navMenu.children[newPosition]));\n        window.dispatchEvent(new Event('resize')); // Dispatch the resize event to create more menu.\n    };\n\n    return {\n        init: () => {\n            SubMenu.init();\n            cardScroll();\n            autoCollapse();\n\n            // Prevent the closing of dropdown during the click on help icon.\n            var helpIcon = document.querySelectorAll('.moremenu .dropdown .menu-helpicon');\n            if (helpIcon !== null) {\n                helpIcon.forEach((icon) => {\n                    icon.addEventListener('click', (e) => {\n                        e.stopPropagation();\n                    });\n                });\n            }\n        }\n    };\n});\n"],"names":["define","$","MoreMenu","SubMenu","moveOutMoreMenu","navMenu","outMenus","querySelectorAll","menuslist","forEach","menu","querySelector","classList","remove","add","push","parentNode","removeChild","length","newPosition","children","insertBefore","window","dispatchEvent","Event","init","cards","document","scrollStart","scrollMoved","startPos","scrollPos","card","scrollElement","addEventListener","e","target","currentTarget","pageX","scrollLeft","preventDefault","scroll","stopPropagation","cardScroll","primaryNav","menuBar","autoCollapse","helpIcon","icon"],"mappings":";;;;;;;AAuBAA,qCAAO,CAAC,SAAU,gBAAiB,8BAA8B,SAASC,EAAGC,SAAUC,eAsE7EC,gBAAmBC,aAEL,OAAZA,aAIAC,SAAWD,QAAQE,iBAAiB,qCACpCC,UAAY,MAEC,OAAbF,UAIJA,SAASG,SAASC,OACdA,KAAKC,cAAc,KAAKC,UAAUC,OAAO,iBACzCH,KAAKC,cAAc,KAAKC,UAAUE,IAAI,YAEtCN,UAAUO,KAAKL,MACfA,KAAKM,WAAWC,YAAYP,aAG5BQ,OAASV,UAAUU,OAEnBC,YADYd,QAAQe,SAASF,OAAS,EACZA,QAAU,EAExCV,UAAUC,SAASC,MAASL,QAAQgB,aAAaX,KAAML,QAAQe,SAASD,gBACxEG,OAAOC,cAAc,IAAIC,MAAM,oBAG5B,CACHC,KAAM,KACFtB,QAAQsB,OAhGG,UACXC,MAAQC,SAASpB,iBAAiB,2CACxB,OAAVmB,MAAgB,KACZE,YACAC,gBACAC,SAAUC,UAEdL,MAAMjB,SAASuB,WACPC,cAAgBD,KAAKrB,cAAc,kBAEvCsB,cAAcC,iBAAiB,aAAcC,IACzCP,aAAc,MACVQ,OAASD,EAAEE,cAAc1B,cAAc,uBAC3CmB,SAAWK,EAAEG,MACbP,UAAYK,OAAOG,cAGvBN,cAAcC,iBAAiB,aAAcC,OACzCA,EAAEK,kBACGZ,mBAGLC,aAAc,MACVO,OAASD,EAAEE,cAAc1B,cAAc,6BACrC8B,OAASN,EAAEG,MAAQR,SACzBM,OAAOG,WAAaR,UAAYU,UAGpCR,cAAcC,iBAAiB,SAAUC,IACjCN,cACAM,EAAEK,iBACFX,aAAc,GAElBM,EAAEO,qBAENT,cAAcC,iBAAiB,cAAc,KACzCN,aAAc,EACdC,aAAc,KAElBI,cAAcC,iBAAiB,WAAW,KACtCN,aAAc,UAyDtBe,GAhDa,UACbC,WAAajB,SAAShB,cAAc,mCACxCP,gBAAgBwC,gBAEZC,QAAUlB,SAAShB,cAAc,2BACrCP,gBAAgByC,UA4CZC,OAGIC,SAAWpB,SAASpB,iBAAiB,sCACxB,OAAbwC,UACAA,SAAStC,SAASuC,OACdA,KAAKd,iBAAiB,SAAUC,IAC5BA,EAAEO"}