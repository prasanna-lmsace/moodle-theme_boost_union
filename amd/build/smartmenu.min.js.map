{"version":3,"file":"smartmenu.min.js","sources":["../src/smartmenu.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Union - JS for smartmenu to make the third level submenu support.\n *\n * @module     theme_boost_union/smartmenu\n * @copyright  bdecent GmbH 2023\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\"jquery\", \"core/moremenu\"], function($, moremenu) {\n    /**\n     * Implement the second level of submenu support.\n     * Find the submenus inside the dropdown add event listener for click event, on the click show the submenu list.\n     */\n    const addSubmenu = () => {\n        // Fetch the list of submenus from moremenu.\n        var submenu = document.querySelectorAll('nav.moremenu .dropdown-submenu');\n        if (submenu !== null) {\n            submenu.forEach((item) => {\n                // Add event listener to show the submenu on click.\n                item.addEventListener('click', (e) => {\n                    var target = e.currentTarget;\n                    // Hide the shown menu.\n                    hideSubmenus(target);\n                    target.classList.toggle('show');\n                    // Prevent the hide of parent menu.\n                    e.stopPropagation();\n                });\n\n\n            });\n        }\n\n        // Prevent the closing of dropdown during the click on help icon.\n        var helpIcon = document.querySelectorAll('.moremenu .dropdown .menu-helpicon');\n        if (helpIcon !== null) {\n            helpIcon.forEach((icon) => {\n                icon.addEventListener('click', (e) => {\n                    e.stopPropagation();\n                });\n            });\n        }\n    };\n\n    /**\n     * Hide visible submenus before display new submenu.\n     *\n     * @param {Selector} target\n     */\n    const hideSubmenus = (target) => {\n        var visibleMenu = document.querySelectorAll('nav.moremenu .dropdown-submenu.show');\n        if (visibleMenu !== null) {\n            visibleMenu.forEach((el) => {\n                if (el != target) {\n                    el.classList.remove('show');\n                }\n            });\n        }\n    };\n\n    /**\n     * Make the no wrapped card menus scroll using swipe or drag.\n     */\n    const cardScroll = () => {\n        var cards = document.querySelectorAll('.card-dropdown.card-overflow-no-wrap');\n        if (cards !== null) {\n            var scrollStart; // Verify the mouse is clicked and still in click not released.\n            var scrollMoved; // Prevent the click on scrolling.\n            let startPos, scrollPos;\n\n            cards.forEach((card) => {\n                var scrollElement = card.querySelector('.dropdown-menu');\n\n                scrollElement.addEventListener('mousedown', (e) => {\n                    scrollStart = true;\n                    var target = e.currentTarget.querySelector('.card-block-wrapper');\n                    startPos = e.pageX;\n                    scrollPos = target.scrollLeft;\n                });\n\n                scrollElement.addEventListener('mousemove', (e) => {\n                    e.preventDefault();\n                    if (!scrollStart) {\n                        return;\n                    }\n                    scrollMoved = true;\n                    var target = e.currentTarget.querySelector('.card-block-wrapper');\n                    const scroll = e.pageX - startPos;\n                    target.scrollLeft = scrollPos - scroll;\n                });\n\n                scrollElement.addEventListener('click', (e) => {\n                    if (scrollMoved) {\n                        e.preventDefault();\n                        scrollMoved = false;\n                    }\n                    e.stopPropagation();\n                });\n                scrollElement.addEventListener('mouseleave', () => {\n                    scrollStart = false;\n                    scrollMoved = false;\n                });\n                scrollElement.addEventListener('mouseup', () => {\n                    scrollStart = false;\n                });\n        });\n        }\n    };\n\n    /**\n     * Move the menubar and primary navigation menu items from more menu.\n     */\n    const autoCollapse = () => {\n        var primaryNav = document.querySelector('.primary-navigation ul.more-nav');\n        moveOutMoreMenu(primaryNav);\n\n        var menuBar = document.querySelector('nav.menubar ul.more-nav');\n        moveOutMoreMenu(menuBar);\n    };\n\n    /**\n     * Move the items from moremenu, items which is set to force outside moremenu.\n     * Remove those items from more menu and insert the menu before the last normal item.\n     * Find the length and childrens length to insert the out menus in that positions.\n     * Rerun the moremenu it will more the other normal menus into more menu to fix the alignmenu issue.\n     *\n     * @param {HTMLElement} navMenu The navbar container.\n     */\n    const moveOutMoreMenu = (navMenu) => {\n\n        if (navMenu === null) {\n            return;\n        }\n\n        var outMenus = navMenu.querySelectorAll('.dropdownmoremenu .force-menu-out');\n        var menuslist = [];\n\n        if (outMenus === null) {\n            return;\n        }\n\n        outMenus.forEach((menu) => {\n            menu.querySelector('a').classList.remove('dropdown-item');\n            menu.querySelector('a').classList.add('nav-link');\n\n            menuslist.push(menu);\n            menu.parentNode.removeChild(menu);\n        });\n        // Find the length and childrens length to insert the out menus in that positions.\n        var length = menuslist.length;\n        var navLength = navMenu.children.length - 1; // Remove more menu.\n        var newPosition = navLength - length || 0;\n        // Insert the stored menus before the more menu.\n        menuslist.forEach((menu) => navMenu.insertBefore(menu, navMenu.children[newPosition]));\n        moremenu(navMenu);\n    };\n\n    return {\n        init: () => {\n            addSubmenu();\n            cardScroll();\n            autoCollapse();\n        }\n    };\n\n});\n"],"names":["define","$","moremenu","hideSubmenus","target","visibleMenu","document","querySelectorAll","forEach","el","classList","remove","moveOutMoreMenu","navMenu","outMenus","menuslist","menu","querySelector","add","push","parentNode","removeChild","length","newPosition","children","insertBefore","init","submenu","item","addEventListener","e","currentTarget","toggle","stopPropagation","helpIcon","icon","addSubmenu","cards","scrollStart","scrollMoved","startPos","scrollPos","card","scrollElement","pageX","scrollLeft","preventDefault","scroll","cardScroll","primaryNav","menuBar","autoCollapse"],"mappings":";;;;;;;AAuBAA,qCAAO,CAAC,SAAU,kBAAkB,SAASC,EAAGC,gBAwCtCC,aAAgBC,aACdC,YAAcC,SAASC,iBAAiB,uCACxB,OAAhBF,aACAA,YAAYG,SAASC,KACbA,IAAML,QACNK,GAAGC,UAAUC,OAAO,YA0E9BC,gBAAmBC,aAEL,OAAZA,aAIAC,SAAWD,QAAQN,iBAAiB,qCACpCQ,UAAY,MAEC,OAAbD,UAIJA,SAASN,SAASQ,OACdA,KAAKC,cAAc,KAAKP,UAAUC,OAAO,iBACzCK,KAAKC,cAAc,KAAKP,UAAUQ,IAAI,YAEtCH,UAAUI,KAAKH,MACfA,KAAKI,WAAWC,YAAYL,aAG5BM,OAASP,UAAUO,OAEnBC,YADYV,QAAQW,SAASF,OAAS,EACZA,QAAU,EAExCP,UAAUP,SAASQ,MAASH,QAAQY,aAAaT,KAAMH,QAAQW,SAASD,gBACxErB,SAASW,kBAGN,CACHa,KAAM,KAhJS,UAEXC,QAAUrB,SAASC,iBAAiB,kCACxB,OAAZoB,SACAA,QAAQnB,SAASoB,OAEbA,KAAKC,iBAAiB,SAAUC,QACxB1B,OAAS0B,EAAEC,cAEf5B,aAAaC,QACbA,OAAOM,UAAUsB,OAAO,QAExBF,EAAEG,4BAQVC,SAAW5B,SAASC,iBAAiB,sCACxB,OAAb2B,UACAA,SAAS1B,SAAS2B,OACdA,KAAKN,iBAAiB,SAAUC,IAC5BA,EAAEG,yBAyHVG,GAhGW,UACXC,MAAQ/B,SAASC,iBAAiB,2CACxB,OAAV8B,MAAgB,KACZC,YACAC,gBACAC,SAAUC,UAEdJ,MAAM7B,SAASkC,WACPC,cAAgBD,KAAKzB,cAAc,kBAEvC0B,cAAcd,iBAAiB,aAAcC,IACzCQ,aAAc,MACVlC,OAAS0B,EAAEC,cAAcd,cAAc,uBAC3CuB,SAAWV,EAAEc,MACbH,UAAYrC,OAAOyC,cAGvBF,cAAcd,iBAAiB,aAAcC,OACzCA,EAAEgB,kBACGR,mBAGLC,aAAc,MACVnC,OAAS0B,EAAEC,cAAcd,cAAc,6BACrC8B,OAASjB,EAAEc,MAAQJ,SACzBpC,OAAOyC,WAAaJ,UAAYM,UAGpCJ,cAAcd,iBAAiB,SAAUC,IACjCS,cACAT,EAAEgB,iBACFP,aAAc,GAElBT,EAAEG,qBAENU,cAAcd,iBAAiB,cAAc,KACzCS,aAAc,EACdC,aAAc,KAElBI,cAAcd,iBAAiB,WAAW,KACtCS,aAAc,UAyDtBU,GAhDa,UACbC,WAAa3C,SAASW,cAAc,mCACxCL,gBAAgBqC,gBAEZC,QAAU5C,SAASW,cAAc,2BACrCL,gBAAgBsC,UA4CZC"}